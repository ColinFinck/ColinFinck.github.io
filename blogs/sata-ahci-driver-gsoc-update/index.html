<!DOCTYPE html>
<html lang="en-us">
	<head>
	<meta charset="utf-8">

	

	<meta name="robots" content="noindex">
	<meta name="googlebot" content="noindex">

	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SATA AHCI Driver GSoC - Update | ReactOS Project</title>
	<meta name="author" content="" />

	
	<meta name="keywords" content="ReactOS, react, os, open source, free, win32, winapi">
	

	
	<meta name="description" content="ReactOS is a free, opensource reimplementation of windows">
	

	<meta name="generator" content="Hugo 0.57.0" />

	<link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet'
		type='text/css'>

	
	<link rel="stylesheet" href="/css/font-awesome.min.css">
	<link rel="stylesheet" href="/css/bootstrap.min.css">

	<link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">

	
	<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
	<link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />

	

	<link rel="alternate" href="https://colinfinck.github.io/index.xml" type="application/rss+xml" title="ReactOS Website">

	
	<meta property="og:title" content="SATA AHCI Driver GSoC - Update" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://colinfinck.github.io/blogs/sata-ahci-driver-gsoc-update//" />
	<meta property="og:image" content="/sites/default/files/ReactOS_0.png" />

</head>

	<body>
		<div style="width:100%; height:30px; background-color:red; color:white; display:block; top:0px;padding-bottom:30px;font-size:18px;">
    <center>WORK IN PROGRESS!</center>
</div>

		<header>
			<div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">
	<div class="navbar navbar-default yamm" role="navigation" id="navbar">
		<div class="col-md-offset-1 col-md-10">
			<div class="navbar-header">
				<a class="navbar-brand home" href="https://colinfinck.github.io/">
					<img src="https://colinfinck.github.io//sites/default/files/ReactOS_0.png" alt="SATA AHCI Driver GSoC - Update logo"
						class="hidden-xs hidden-sm">
					<img src="https://colinfinck.github.io//sites/default/files/ReactOS_0.png" alt="SATA AHCI Driver GSoC - Update logo"
						class="visible-xs visible-sm">
					<span class="sr-only">SATA AHCI Driver GSoC - Update - go to homepage</span>
				</a>
				<div class="navbar-buttons">
					<button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse"
						data-target="#navigation">
						<span class="sr-only">Toggle Navigation</span>
						<i class="fa fa-align-justify"></i>
					</button>
				</div>
			</div>

			<div class="navbar-collapse collapse" id="navigation">
				<ul class="nav navbar-nav navbar-right">
					
					
					

					<li
						class="dropdown">
						

							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About<span class="caret"></span></a>
							<ul class="dropdown-menu">
								
								<li><a href="/what-is-reactos">What is ReactOS?</a></li>
								
								<li><a href="/reactos-legal">Is ReactOS legal?</a></li>
								
								<li><a href="/faq">FAQ</a></li>
								
							</ul>
						
					</li>
					
					

					<li
						class="dropdown">
						

							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">News<span class="caret"></span></a>
							<ul class="dropdown-menu">
								
								<li><a href="/news/">All News</a></li>
								
								<li><a href="/project-news/">Project News</a></li>
								
								<li><a href="/blogs/">Blog Posts</a></li>
								
							</ul>
						
					</li>
					
					

					<li
						class="dropdown">
						

							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Community<span class="caret"></span></a>
							<ul class="dropdown-menu">
								
								<li><a href="https://chat.reactos.org">Chat</a></li>
								
								<li><a href="/forum">Forum</a></li>
								
								<li><a href="https://reactos.spreadshirt.net">Shop</a></li>
								
							</ul>
						
					</li>
					
					

					<li
						class="dropdown">
						

							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Development<span class="caret"></span></a>
							<ul class="dropdown-menu">
								
								<li><a href="https://reactos.org/wiki/Building_ReactOS">Building ReactOS</a></li>
								
								<li><a href="https://jira.reactos.org">Jira</a></li>
								
								<li><a href="/getbuilds">Download ReactOS Builds</a></li>
								
								<li><a href="https://github.com/reactos">ReactOS on GitHub</a></li>
								
								<li><a href="https://reactos.org/wiki/File_Bugs">Report a Bug</a></li>
								
								<li><a href="/testman">Testman</a></li>
								
								<li><a href="/wiki">Wiki</a></li>
								
								<li><a href="/developing">Contribute</a></li>
								
								<li><a href="/jobs#paid-jobs">Work for ReactOS</a></li>
								
							</ul>
						
					</li>
					
					

					<li
						class="dropdown">
						
							<a href="/donate">Donate</a>
						
					</li>
					
					

					<li
						class="dropdown">
						
							<a href="/download">Download</a>
						
					</li>
					
				</ul>
			</div>

			<div class="collapse clearfix" id="search">
				<form class="navbar-form" role="search">
					<div class="input-group">
						<input type="text" class="form-control" placeholder="Search">
						<span class="input-group-btn">
							<button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
						</span>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

		</header>

		<div class="container-fluid">
			<div class="row" id="heading-breadcrumbs">
	<div class="col-md-offset-1 col-md-10">
		
		
		<div class="breadcrumbs">
			<a href="https://colinfinck.github.io/">home</a>
			
			
			
			/ <a href='https://colinfinck.github.io/blogs'>blogs</a>
			
			
			
			
			
			/ <a href='https://colinfinck.github.io/blogs/sata-ahci-driver-gsoc-update'>sata-ahci-driver-gsoc-update</a>
			
			
			
			
			
			
		</div>
		<h1>SATA AHCI Driver GSoC - Update</h1>
	</div>
</div>

			<section id="content" class="row">
				<div class="col-md-10 col-md-offset-1">
					<div class="col-md-9 row" id="blog-post">
						<p class="text-muted mb-small text-right">by <a href="#">amaneureka</a> | July 25, 2016</p>

						<div id="post-content">
							
<!-- [ContentTable] -->
<strong><a name="#">Links</a></strong><br>
<ul>
	<li><a href="#tldr">Short Brief</a></li>
	<li><a href="#testing">Driver Testing</a></li>
	<li><a href="#noBlog">Why no blog?</a></li>
	<li><a href="#knownIssues">Known Issues</a></li>
</ul>
<br>
<br>
<!-- [!ContentTable] -->

<!-- [TLDR] -->
<strong><a name="tldr">Short Brief</a></strong><br>
Supported Features:<br>
<ul>
	<li>Device Adapter Detection</li>
	<li>Non-Fatal Error Handling</li>
	<li>Adapter Srb PNP Request</li>
	<li><a href="#SCSIOP_INQUIRY">SCSIOP_INQUIRY : Device Inquiry</a></li>
	<li>SCSIOP_REPORT_LUNS : Report LUN</li>
	<li>SCSIOP_READ_CAPACITY : Device Geometry</li>
	<li>SCSIOP_TEST_UNIT_READY</li>
	<li><a href="#SCSIOP_READ">SCSIOP_READ : Device Read Request</a></li>
</ul>
UnSupported Features:<br>
<ul>
	<li>Fatal Error Handling</li>
	<li>SCSIOP_MODE_SENSE</li>
	<li><a href="#SCSIOP_READ">SCSIOP_WRITE</a></li>
	<li>NCQ : Native Command Queuing</li>
	<li>Cache and Priority Requests</li>
</ul>
<br>
<!-- [!TLDR] -->

<!-- [Testing] -->
<strong><a name="testing">Driver Testing</a></strong><br>
Platform: Virtual Machine (Vmware)<br>
Operating System: Windows Server 2003 x86 Free Build<br><br>
<strong>Device Management Window</strong><br>
<img src="/sites/default/files/imagepicker/49146/devmgmt_vm.png" alt="devmgmt vm" class="imgp_img" width="640" height="452" /><br>
Detected Devices: &quot;2 3 SCSI Disk Driver&quot;<br>
2, 3 are actually faked VendorId and Product ID, Please refer to <a href="https://github.com/amaneureka/reactos/blob/master/reactos/drivers/storage/storahci/storahci.c#L1675">code</a> for more detail.<br><br><br>
<strong>Vmware Settings Tab</strong><br>
<img src="/sites/default/files/imagepicker/49146/vm_settings.png" alt="vm settings"  class="imgp_img" width="690" height="620" /><br><br>
<strong>Disk Management</strong><br>
<img src="/sites/default/files/imagepicker/49146/diskmgmt_0.png" alt="Image"  class="imgp_img" width="640" height="554" /><br>
Though windows is not able to detect NTFS formatted partition (Disk 2, Partition 1) maybe because It was expecting a write support first. So, I tried to dump partition and compared it with raw virtual hard disk file(VHD) dump, So Reading Feature is working perfectly.<br><br>
<strong>Active Disk Editor - VHD mounted image (Host PC, Windows 10)</strong><br>
<img src="/sites/default/files/imagepicker/49146/active_disc_editor_host.png" alt="Image"  class="imgp_img" width="1360" height="764" /><br><br>
<strong>Active Disk Editor - Win2k3 (Vmware)</strong><br>
<img src="/sites/default/files/imagepicker/49146/active_disc_editor_vm.png" alt="Image"  class="imgp_img" width="1367" height="768" /><br>
<br>
<!-- [!Testing] -->

<!-- [SCSIOP_READ] -->
<strong><a name="SCSIOP_READ">SCSIOP_READ</a></strong><br>
Routine: DeviceRequestReadWrite<br>
Description: This Routine Handles Read &amp; Write SRB_FUNCTION_EXECUTE_SCSI Requests, but currently supports Read Request only.<br>
Unsupported Features:<br>
<ul>
	<li>SCSIOP_WRITE</li>
	<li>NCQ</li>
	<li>Non Lba48BitMode</li>
</ul>
Assumptions:<br>
<ul>
	<li>SectorCount &lt; 0x100</li>
</ul>
Why not write feature supported?<br>
I am unsure about CommandReg value (considering all cases) and that is why I am not able to program TaskFile for write request, though Routine is perfectly implemented and a correct value of CommandReg will make it work.<br>
on a side note, I tried to set CommandReg = IDE_COMMAND_WRITE_DMA, But It crashed with Fatal Error (TFES : TaskFileErrorStatus != 0)<br>
<br>
<!-- [!SCSIOP_READ] -->

<!-- [SCSIOP_INQUIRY] -->
<strong><a name="SCSIOP_INQUIRY">SCSIOP_INQUIRY</a></strong><br>
Routine: DeviceInquiryRequest<br>
Description: This Routine Handles EVPD and VPD Requests.<br>
Unsupported Features:<br>
<ul>
	<li>VPD_SERIAL_NUMBER (storport.h)</li>
	<li>VPD_DEVICE_IDENTIFIERS (storport.h)</li>
	<li>VPD_MEDIA_SERIAL_NUMBER (storport.h)</li>
	<li>VPD_NETWORK_MANAGEMENT_ADDRESSES (storport.h)</li>
	<li>VPD_EXTENDED_INQUIRY_DATA (storport.h)</li>
	<li>VPD_MODE_PAGE_POLICY (storport.h)</li>
	<li>VPD_SCSI_PORTS (storport.h)</li>
</ul>
I don't think we need to support all VPD functions, though right now code assumes only one supported functions but driver will have support for VPD_SERIAL_NUMBER, VPD_MEDIA_SERIAL_NUMBER and VPD_EXTENDED_INQUIRY_DATA in future.<br>
<br>
<!-- [!SCSIOP_INQUIRY] -->

<!-- [knownIssues] -->
<strong><a name="knownIssues">Known Issues</a></strong><br>
Well, There is only one issue which I was able to find while testing the driver. It is the file system detection, Though It maybe because windows was expecting a write support too, and hence failed to detect filesystem; But I am not really sure on this point so I have better decided to put this into known issue section.
<br><br>
<!-- [!knownIssues] -->

<!-- [noBlog] -->
<strong><a name="noBlog">Why no blog?</a></strong><br>
Well It is known that I didn't made any blog entry for past 3 weeks, Below I have listed the reason<br>
<ul>
	<li><strong>Week 6: </strong>I was selected for Indian Programming Camp organised by <a href="https://www.codechef.com/">CodeChef</a>, They <a href="https://www.facebook.com/aman.eureka/posts/889186054558802?pnref=story">shortlisted 22 candidates</a> (sport programmers) to join the camp and learn some advance tricks to tackle programming contest's problems. I don't want to miss this oppurtunity so I talked to my mentor and he supported my decision of halting project for few days and join the camp.<br>
	Though I wasn't really inactive on project, I completed Dpc handling routine while traveling and fixed many bugs whenever I got time in camp.</li>
	<li><strong>Week 7: </strong>I was back to home, but interrupt bug actually pissed me, and I was giving 100% of my time in debugging stuffs.</li>
	<li><strong>Week 8: </strong>Well, All bugs were fixed by the end of week 7; But I was little tensed about project timeline so I worked on unsupported feature and decided to create blog entry once I am done with Read Request feature</li>
</ul>
There is one more reason for not giving any priority to blogs, I hate writing blogs :P<br>
<br>
<!-- [!noBlog] -->

						</div>
					</div>

					<div class="col-md-3">
						

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="https://colinfinck.github.io/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>












<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="https://colinfinck.github.io/tags/0.4.7"><i class="fa fa-tags"></i> 0.4.7</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/0.4.8"><i class="fa fa-tags"></i> 0.4.8</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/0.4.9"><i class="fa fa-tags"></i> 0.4.9</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/announce"><i class="fa fa-tags"></i> announce</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/call"><i class="fa fa-tags"></i> call</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/cc"><i class="fa fa-tags"></i> cc</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/contributions"><i class="fa fa-tags"></i> contributions</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/drwatson"><i class="fa fa-tags"></i> drwatson</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/filesystems"><i class="fa fa-tags"></i> filesystems</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/gsoc"><i class="fa fa-tags"></i> gsoc</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/hello"><i class="fa fa-tags"></i> hello</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/mm"><i class="fa fa-tags"></i> mm</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/network"><i class="fa fa-tags"></i> network</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/nt6"><i class="fa fa-tags"></i> nt6</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/ntfs"><i class="fa fa-tags"></i> ntfs</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/office"><i class="fa fa-tags"></i> office</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/rapps"><i class="fa fa-tags"></i> rapps</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/release"><i class="fa fa-tags"></i> release</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/revamp"><i class="fa fa-tags"></i> revamp</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/self-hosting"><i class="fa fa-tags"></i> self-hosting</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/shell"><i class="fa fa-tags"></i> shell</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/social"><i class="fa fa-tags"></i> social</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/students"><i class="fa fa-tags"></i> students</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/taskbar"><i class="fa fa-tags"></i> taskbar</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/telegram"><i class="fa fa-tags"></i> telegram</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/usb"><i class="fa fa-tags"></i> usb</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/website"><i class="fa fa-tags"></i> website</a>
            </li>
            
            <li><a href="https://colinfinck.github.io/tags/zipfldr"><i class="fa fa-tags"></i> zipfldr</a>
            </li>
            
        </ul>
    </div>
</div>





					</div>
				</div>
			</section>

			<footer class="row" id="copyright">
	<div class="col-md-offset-1 col-md-10">
		<div class="col-md-4">&copy; 1996-2019 ReactOS Team &amp; Contributors</div>

		<div class="col-md-4">
			<ul class="links">
				
					<li><a href="https://github.com/colinfinck/web-content/tree/master/content/blogs/sata-ahci-driver-gsoc-update.html">Improve this page</a></li>
				
			</ul>
		</div>

		<div class="col-md-4 text-right">
			Template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
			
			Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>

			<div class="pull-right">
				<div class="social">
					<a class="facebook" href="https://facebook.com/ReactOS-19143619259" target="_blank"><i class="fa fa-facebook"></i></a>
					<a href="https://github.com/reactos" target="_blank"><i class="fa fa-github"></i></a>
					<a class="twitter" href="https://twitter.com/reactos" target="_blank"><i class="fa fa-twitter"></i></a>
					<a class="vk" href="https://vk.com/reactos_ru" target="_blank"><i class="fa fa-vk"></i></a>
					<a class="youtube" href="https://youtube.com/c/ReactOSCommunity" target="_blank"><i class="fa fa-youtube"></i></a>
				</div>

				<ul class="links">
					<li><a href="/legal">Legal</a></li>
				</ul>
			</div>
		</div>
	</div>
</footer>

		</div>

		<script src="https://colinfinck.github.io/js/jquery-3.3.1.min.js"></script>
<script src="https://colinfinck.github.io/js/bootstrap.min.js"></script>



	</body>
</html>
